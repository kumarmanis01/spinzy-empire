Below is a senior-enterprise-architect level design for Admin Dashboards, covering:

- Conceptual architecture
- What admins need to see & do
- API routes (clean contracts)
- UI layout & wireframes (textual)
- How dashboards interact with pipeline, jobs, workers
- Telemetry & health correlation
- Guardrails (what UI can and cannot do)

This is designed to fit exactly into the architecture you locked above, not fight it.

---

# ADMIN DASHBOARDS â€” SYSTEM DESIGN

## 1. Purpose of Admin Dashboards

Admin dashboards are not CRUD UIs.  
They are observability + control surfaces for:

- Academic correctness
- AI reliability
- Operational health
- Human approval workflows

They answer four core admin questions:

1. What content exists, at what stage, for which board/class/subject/topic?
2. What jobs are running, stuck, failing, or retrying â€” and why?
3. Is the AI behaving well (cost, failures, latency)?
4. Can I intervene safely (approve, retry, cancel, rollback)?

---

## 2. Dashboard Modules (High-Level)

- **Admin Console**
    - Academic Explorer
    - Content Moderation
    - Job Monitor
    - Execution Pipeline Health
    - AI / LLM Telemetry
    - System Events & Audit Logs

Each module maps to specific API routes and DB tables.

---

## 3. Academic Explorer Dashboard

**Purpose:**  
Canonical, read-only navigation of the entire academic hierarchy.

**UI Wireframe**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Academic Explorer                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Board â–¼  CBSE                             â”‚
â”‚ Class â–¼  6                                â”‚
â”‚ Subject â–¼ Mathematics                     â”‚
â”‚ Chapter â–¼ Fractions (v1)                  â”‚
â”‚ Topic â–¼ Proper Fractions                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Content Summary                           â”‚
â”‚ - Notes: Draft (Hindi), Approved (English)â”‚
â”‚ - Tests: 2 Draft, 1 Approved              â”‚
â”‚ - Questions: 30 total                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API Contract**

- `GET /api/hierarchy`  
    Returns the full academic hierarchy tree.
- `GET /api/admin/content-summary?topicId=`  
    Returns content summary for a topic.

**Guardrails**

- No editing or creation here
- Pure observability

---

## 4. Content Moderation Dashboard

**Purpose:**  
Human approval of AI-generated academic content.

**UI Wireframe**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Content Moderation                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Filters:                                  â”‚
â”‚ Board | Class | Subject | Topic | Languageâ”‚
â”‚ Status: Draft / Approved                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Topic] Proper Fractions                  â”‚
â”‚ Type: Notes (Hindi)                       â”‚
â”‚ Version: v1                               â”‚
â”‚ Generated by: AI                          â”‚
â”‚                                            â”‚
â”‚ [Content Viewer]                          â”‚
â”‚                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚ â”‚ Approve   â”‚  â”‚ Reject    â”‚              â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API Contracts**

- Fetch pending content  
    `GET /api/admin/moderation/notes?status=draft`  
    `GET /api/admin/moderation/tests?status=draft`
- Approve  
    `POST /api/admin/moderation/notes/{id}/approve`
- Reject (with reason)  
    `POST /api/admin/moderation/notes/{id}/reject`  
    Payload: `{ "reason": "Incorrect example in paragraph 2" }`

**DB Effects**

- status: draft â†’ approved
- editedByTeacher = true (if modified)
- Creates moderation audit log

---

## 5. Job Monitor Dashboard

**Purpose:**  
Answer: â€œWhy is my job stuck / failed / retrying?â€

**UI Wireframe**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Job Monitor                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Filters:                                  â”‚
â”‚ Status | Job Type | Entity Type | Date     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Job ID        Type        Status     Retriesâ”‚
â”‚ abc123        NOTES       RUNNING    1/3    â”‚
â”‚ def456        SYLLABUS    FAILED     3/3 âŒ â”‚
â”‚ ghi789        TESTS       PENDING    0/3 âš  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Selected Job Details                      â”‚
â”‚ - Entity: Topic â†’ Proper Fractions        â”‚
â”‚ - Created At:                             â”‚
â”‚ - Last Error: LLM timeout                 â”‚
â”‚ - Retry Policy: Exponential (3)           â”‚
â”‚                                            â”‚
â”‚ [Retry] [Cancel]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API Contracts**

- List jobs  
    `GET /api/admin/jobs?status=FAILED`
- Job details  
    `GET /api/admin/jobs/{jobId}`
- Retry  
    `POST /api/admin/jobs/{jobId}/retry`
- Cancel  
    `POST /api/admin/jobs/{jobId}/cancel`

**Pipeline Interaction**

- Retry â†’ re-enqueue via Execution Pipeline
- Cancel â†’ sets terminal state, worker checks cancellation token

---

## 6. Execution Pipeline Health Dashboard

**Purpose:**  
Detect systemic failures, not content issues.

**UI Wireframe**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Execution Pipeline Health                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Queue Status: Connected âœ…                 â”‚
â”‚ Active Workers: 3                          â”‚
â”‚ Pending Jobs: 12                           â”‚
â”‚ Oldest Pending: 8m âš                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Retry Rates (last 1h):                    â”‚
â”‚ - NOTES: 5%                               â”‚
â”‚ - TESTS: 18% âš                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API Contracts**

- Pipeline status  
    `GET /api/admin/pipeline/status`  
    Returns:
    ```json
    {
        "queueConnected": true,
        "activeWorkers": 3,
        "pendingJobs": 12,
        "oldestPendingMs": 480000
    }
    ```

---

## 7. AI / LLM Telemetry Dashboard

**Purpose:**  
Cost + reliability governance.

**UI Wireframe**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Telemetry                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Avg Latency: 2.1s                          â”‚
â”‚ Timeout Rate: 3.2%                         â”‚
â”‚ Daily Cost: â‚¹4,230                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Errors by Type:                           â”‚
â”‚ - Timeout                                 â”‚
â”‚ - Rate Limit                              â”‚
â”‚ - Invalid Output                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API**

- `GET /api/admin/telemetry/llm`

---

## 8. System Events & Audit Logs

**Purpose:**  
Compliance, debugging, trust.

**Captures:**
- Job state transitions
- Content approvals
- Deletions (soft)
- Admin actions
- Worker crashes

**API**

- `GET /api/admin/audit?entityType=Topic&id=...`

---

## 9. How Dashboards Interact with Pipeline

Dashboard Action  
     â†“  
Admin API  
     â†“  
Execution Pipeline  
     â†“  
Queue / Worker  
     â†“  
Telemetry Event  
     â†“  
Dashboard Refresh

Dashboards never talk to workers directly.

---

## 10. Admin UI Guardrails

- No free-text academic inputs
- No direct DB edits
- No bypassing approval
- No retry without job context
- IDs only
- Explicit actions
- Visible consequences
- Audit trail everywhere

---

## 11. Why This Design Prevents Your Current Issue

â€œJob submitted but sitting in pending foreverâ€

Because now:

- Job state transitions are visible
- Pipeline health shows queue / worker disconnect
- Retry + cancel are explicit
- Telemetry exposes where it broke
- No more blind spots

---

## Enterprise-Grade Delivery: Admin Dashboards

### Section 1 â€” Admin API Route Stubs

These APIs are read-only by default, ID-driven, audited, and pipeline-aware.

#### 1.1 Academic Hierarchy (Read-only, cached)

- `GET /api/admin/hierarchy`  
    Purpose: Single canonical source for UI navigation

<details>
<summary>Example (TypeScript)</summary>

```ts
// /api/admin/hierarchy/route.ts
import { prisma } from "@/lib/prisma"
import { NextResponse } from "next/server"

export async function GET() {
    const boards = await prisma.board.findMany({
        where: { lifecycle: "active" },
        include: {
            classes: {
                where: { lifecycle: "active" },
                orderBy: { grade: "asc" },
                include: {
                    subjects: {
                        include: {
                            chapters: {
                                where: { lifecycle: "active" },
                                orderBy: { order: "asc" },
                                include: {
                                    topics: {
                                        where: { lifecycle: "active" },
                                        orderBy: { order: "asc" }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    })

    return NextResponse.json(boards)
}
```
</details>

**Guardrails**
- No writes
- No filtering by string
- IDs only
- Cacheable

#### 1.2 Content Moderation APIs

- Fetch draft content  
    `GET /api/admin/moderation/notes?status=draft`  
    `GET /api/admin/moderation/tests?status=draft`

<details>
<summary>Example (TypeScript)</summary>

```ts
export async function GET(req: Request) {
    const { searchParams } = new URL(req.url)
    const status = searchParams.get("status") ?? "draft"

    const notes = await prisma.topicNote.findMany({
        where: { status },
        include: {
            topic: {
                include: {
                    chapter: { include: { subject: { include: { class: { include: { board: true }}}}}}
                }
            }
        },
        orderBy: { createdAt: "desc" }
    })

    return NextResponse.json(notes)
}
```
</details>

- Approve / Reject Content  
    `POST /api/admin/moderation/notes/:id/approve`  
    `POST /api/admin/moderation/notes/:id/reject`

<details>
<summary>Example (TypeScript)</summary>

```ts
export async function POST(_: Request, { params }: { params: { id: string }}) {
    await prisma.topicNote.update({
        where: { id: params.id },
        data: { status: "approved" }
    })

    return NextResponse.json({ success: true })
}
```
</details>

Audit log must be written here.

#### 1.3 Job Monitor APIs

- List Jobs  
    `GET /api/admin/jobs?status=FAILED`

<details>
<summary>Example (TypeScript)</summary>

```ts
export async function GET(req: Request) {
    const { searchParams } = new URL(req.url)
    const status = searchParams.get("status")

    const jobs = await prisma.hydrationJob.findMany({
        where: status ? { status } : {},
        orderBy: { createdAt: "desc" }
    })

    return NextResponse.json(jobs)
}
```
</details>

- Retry / Cancel  
    `POST /api/admin/jobs/:id/retry`  
    `POST /api/admin/jobs/:id/cancel`

<details>
<summary>Example (TypeScript)</summary>

```ts
export async function POST(_: Request, { params }: any) {
    await prisma.hydrationJob.update({
        where: { id: params.id },
        data: { status: "pending", retries: { increment: 1 } }
    })

    // enqueue via pipeline (lazy init queue)
    await enqueueJob(params.id)

    return NextResponse.json({ success: true })
}
```
</details>

#### 1.4 Execution Pipeline Health

- `GET /api/admin/pipeline/status`

Returns:
```json
{
    "queueConnected": true,
    "activeWorkers": 2,
    "pendingJobs": 14,
    "oldestPendingMs": 420000
}
```

#### 1.5 AI Telemetry

- `GET /api/admin/telemetry/llm`  
    Returns aggregated metrics from telemetry table.

---

### Section 2 â€” Admin UI Components (Next.js + SWR)

These are clean, composable dashboards.

#### 2.1 Academic Explorer UI

```tsx
export function AcademicExplorer() {
    const { data } = useSWR("/api/admin/hierarchy", fetcher)

    return (
        <div>
            <HierarchyTree data={data} />
            <ContentSummaryPanel />
        </div>
    )
}
```
Hierarchy tree is read-only.

#### 2.2 Content Moderation UI

```tsx
export function ModerationQueue() {
    const { data } = useSWR("/api/admin/moderation/notes?status=draft", fetcher)

    return data.map(note => (
        <ModerationCard
            key={note.id}
            title={note.title}
            content={note.contentJson}
            onApprove={() => approve(note.id)}
            onReject={() => reject(note.id)}
        />
    ))
}
```

#### 2.3 Job Monitor UI

```tsx
export function JobMonitor() {
    const { data } = useSWR("/api/admin/jobs", fetcher)

    return (
        <table>
            {data.map(job => (
                <JobRow
                    job={job}
                    onRetry={() => retry(job.id)}
                    onCancel={() => cancel(job.id)}
                />
            ))}
        </table>
    )
}
```

#### 2.4 Pipeline Health Dashboard

```tsx
export function PipelineHealth() {
    const { data } = useSWR("/api/admin/pipeline/status", fetcher, { refreshInterval: 5000 })

    return (
        <StatsGrid stats={data} />
    )
}
```

#### 2.5 AI Telemetry Dashboard

- Charts:  
    - Latency over time  
    - Failure rates  
    - Cost per job type

---

### Section 3 â€” Database Schema (Jobs + Telemetry)

#### 3.1 Job Table (Hydration / Generation)

```prisma
model HydrationJob {
    id           String   @id @default(cuid())
    jobType      JobType
    entityType   String // TOPIC | SUBJECT | CHAPTER
    entityId     String

    status       JobStatus @default(pending)
    retries      Int       @default(0)
    maxRetries   Int       @default(3)

    lastError    String?
    startedAt    DateTime?
    finishedAt   DateTime?

    createdAt    DateTime  @default(now())
}
```

#### 3.2 Execution Events (State Machine)

```prisma
model JobExecutionLog {
    id        String   @id @default(cuid())
    jobId     String
    job       HydrationJob @relation(fields: [jobId], references: [id])

    event     String // STARTED | RETRY | FAILED | COMPLETED
    message   String?
    createdAt DateTime @default(now())
}
```

#### 3.3 AI Telemetry

```prisma
model AITelemetry {
    id           String   @id @default(cuid())
    jobId        String?
    model        String
    latencyMs    Int
    tokenCount   Int
    costUsd      Float
    success      Boolean
    errorType    String?
    createdAt    DateTime @default(now())
}
```

#### 3.4 Admin Audit Log

```prisma
model AdminAuditLog {
    id        String   @id @default(cuid())
    adminId  String
    action   String
    entity   String
    entityId String
    metadata Json?
    createdAt DateTime @default(now())
}
```

---

## How All of This Interacts (Mental Model)

Admin UI  
    â†“  
Admin API (ID-based)  
    â†“  
Execution Pipeline  
    â†“  
Queue / Worker  
    â†“  
Telemetry + Job Logs  
    â†“  
Admin Dashboards

No shortcuts. No hidden state.

---

## Why This is Enterprise-Grade

- Deterministic content ownership
- Observable pipelines
- Human-in-the-loop moderation
- Safe retries and cancellations
- Clear onboarding for juniors
- Copilot-safe guardrails

---

## Sequence Diagrams (Canonical)

### 1. Job Lifecycle â€” AI Content Generation

**Scenario:** Admin generates Notes for a Topic

```
Admin UI
     |
     | 1. Select Board â†’ Class â†’ Subject â†’ Topic
     | 2. Click "Generate Notes"
     v
Admin API (/content-engine/jobs)
     |
     | 3. Validate IDs (topicId exists, active)
     | 4. Create HydrationJob (status=pending)
     | 5. Write JobExecutionLog: CREATED
     | 6. Enqueue job via Execution Pipeline
     v
Execution Pipeline
     |
     | 7. Retry-safe enqueue
     | 8. Connectivity checks (Redis/Queue)
     v
Queue (Bull / Redis)
     |
     | 9. Worker pulls job
     v
Worker Process
     |
     | 10. Update job status=running
     | 11. Write JobExecutionLog: STARTED
     |
     | 12. callLLM() (single place)
     | 13. Capture telemetry (tokens, latency)
     |
     | 14. Persist draft content (TopicNote)
     | 15. status=draft (never auto-approve)
     |
     | 16. Update job status=completed
     | 17. Write JobExecutionLog: COMPLETED
     v
Admin Dashboard
     |
     | 18. Job moves to COMPLETED
     | 19. Draft content appears in Moderation Queue
```

**Invariants**

- Job never jumps from pending â†’ completed
- Worker never runs without job ownership
- Content always lands as draft

---

### 2. Moderation Lifecycle â€” Human-in-the-Loop

**Scenario:** Moderator reviews and approves/rejects content

```
Admin Moderator
     |
     | 1. Open Moderation Dashboard
     v
Admin API (/moderation/notes?status=draft)
     |
     | 2. Fetch draft notes with hierarchy context
     v
Moderator UI
     |
     | 3. Review content
     |
     |---- Approve ----|
     |                 |
     |---- Reject -----|
     v                 v
Approve API      Reject API
     |                 |
     | 4a. status=approved
     | 4b. status=rejected
     |
     | 5. Write AdminAuditLog
     | 6. Write JobExecutionLog (if linked)
     v
Content Store
     |
     | 7. Approved content becomes visible
     | 8. Rejected content is hidden but retained
```

**Invariants**

- No edits overwrite AI output without version bump
- Rejection never deletes content
- Approval is explicit, not inferred

---

## Copilot System Instructions (Drop-In)

**Put this in `/docs/COPILOT_RULES.md` and Copilotâ€™s system prompt.**

### Copilot System Directive â€” AI Content Engine

**Global Principles (Non-Negotiable):**

- This is a job-based AI system
- No synchronous AI calls in API routes
- No LLM imports outside `lib/callLLM`
- No string-based hierarchy filtering
- IDs are the source of truth
- All content requires approval
- All failures must be observable

**Data & Schema Rules:**

- Board â†’ ClassLevel â†’ SubjectDef â†’ ChapterDef â†’ TopicDef is canonical
- Never add duplicate hierarchy paths
- Never persist boardName, subjectName, etc. without resolving IDs
- Use joins, not denormalized strings

**API Rules:**

- APIs must validate IDs and reject ambiguous input
- Never create content directly, only enqueue jobs

**Forbidden:**

- Direct LLM calls
- Direct Redis connections at import time
- Free-text hierarchy filters

**Worker Rules:**

- Workers own exactly one job at a time
- Update job status explicitly
- Emit telemetry for every LLM call
- Never approve content

**Hydrator Rules:**

- Only enqueue jobs
- Must be idempotent
- Must check DB before enqueue
- Never call AI

**UI Rules:**

- Must load hierarchy from `/api/admin/hierarchy`
- Must submit IDs only
- Must reset child selections on parent change
- Must show moderation status clearly

**Telemetry & Observability:**

- Every AI call must log latency, tokens, cost, success/failure
- Jobs stuck in pending or running > threshold are surfaced

**Copilot Hard Fail Conditions:**

If any of these appear, STOP and ASK:

- â€œLetâ€™s just call OpenAI hereâ€
- â€œWe can skip the jobâ€
- â€œWeâ€™ll auto-approveâ€
- â€œWe can infer board from textâ€

---

## Admin Dashboard Wireframes (Textual)

### 1. Admin Home Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin Control Center                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ§­ Academic Explorer                 â”‚
â”‚ âš™ï¸  Job Monitor                      â”‚
â”‚ ğŸ“ Moderation Queue                  â”‚
â”‚ ğŸ“Š Pipeline Health                   â”‚
â”‚ ğŸ“ˆ AI Telemetry                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Academic Hierarchy Explorer

```
Board: CBSE â–¼
    Class 6
        Mathematics
            Chapter 1
                Topic A
                Topic B
        Science
    Class 7
        ...
[Generate Syllabus]
[Generate Content]
```
Purpose: Read-only navigation, context provider for all actions

### 3. Job Monitor Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Job Monitor                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Type  â”‚ Entity   â”‚ Status â”‚ Retriesâ”‚ Actionsâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Notes â”‚ Topic A  â”‚ RUNNINGâ”‚ 1      â”‚ Cancel â”‚
â”‚ Test  â”‚ Topic B  â”‚ FAILED â”‚ 2      â”‚ Retry  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Moderation Queue

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Draft Notes (Topic: Fractions)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Title: Understanding Fractions               â”‚
â”‚ -------------------------------------------- â”‚
â”‚ [Rendered Content Preview]                   â”‚
â”‚                                              â”‚
â”‚ -------------------------------------------- â”‚
â”‚ [Approve]   [Reject]   [Edit + Approve]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. Pipeline Health Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Execution Pipeline Health                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Queue Connected: âœ…                          â”‚
â”‚ Active Workers: 2                            â”‚
â”‚ Pending Jobs: 14                             â”‚
â”‚ Oldest Pending: 7m 12s âš ï¸                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. AI Telemetry Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Telemetry                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Avg Latency: 1.8s                            â”‚
â”‚ Failure Rate: 2.1%                           â”‚
â”‚ Cost (24h): $4.32                            â”‚
â”‚                                              â”‚
â”‚ [Latency Chart] [Cost Trend] [Failures]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Final Architect Verdict

You now have:

- Deterministic hierarchy
- Observable execution
- Human approval gates
- Retry-safe pipelines
- Copilot-safe development rules
- Scalable admin UX

This is enterprise-ready, onboarding-safe, and future-proof.
